@page "/json-format"

@namespace ToolBox.Components.Pages.TextTool

@inherits MvvmComponentBase<JsonFormatVM>

<MudStack Row="true" AlignItems="AlignItems.Baseline" Spacing="4" Class="mb-4">
    <MudText Typo="Typo.h4">JSON 格式化/压缩</MudText>
    <MudText>支持排序与去空格压缩。</MudText>
</MudStack>

<MudPaper Class="pa-4 mb-4" Elevation="1">
    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="mb-3">
        <MudCheckBox T="bool" @bind-Value="ViewModel.SortKeys" Label="按键排序" />
        <MudSpacer />
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="() => ViewModel.Format()">格式化</MudButton>
        <MudButton Variant="Variant.Outlined" OnClick="() => ViewModel.Minify()">压缩</MudButton>
        <MudButton Variant="Variant.Outlined" OnClick="() => ViewModel.Validate()">校验</MudButton>
        <MudButton Variant="Variant.Outlined" OnClick="() => ViewModel.Clear()">清空</MudButton>
    </MudStack>

    <MudGrid>
        <MudItem xs="12" md="6">
            <MudText Typo="Typo.h6" GutterBottom="true">输入</MudText>
            <MudTextField T="string" @bind-Value="ViewModel.InputJson"
                             Variant="Variant.Outlined"
                          Lines="12"
                          Immediate="true"
                          Class="json-textarea" />
        </MudItem>
        <MudItem xs="12" md="6">
            <MudText Typo="Typo.h6" GutterBottom="true">输出</MudText>
            <MudTextField T="string" Value="@ViewModel.OutputJson"
                          Variant="Variant.Outlined"
                    
                          Lines="12"
                          ReadOnly="true"
                          Class="json-textarea" />
        </MudItem>
    </MudGrid>

    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="mt-4">
        <MudSelect T="string" Label="模板" @bind-Value="ViewModel.SelectedTemplateKey" Dense="true" Variant="Variant.Outlined" Class="json-template">
            @foreach (var item in ViewModel.TemplateOptions)
            {
                <MudSelectItem T="string" Value="@item.Key">@item.Label</MudSelectItem>
            }
        </MudSelect>
        <MudButton Variant="Variant.Outlined" OnClick="() => ViewModel.ApplyTemplate()">加载模板</MudButton>
    </MudStack>
</MudPaper>

<MudPaper Class="pa-4 mb-4" Elevation="1">
    <MudText Typo="Typo.h6" GutterBottom="true">JSONPath 查询</MudText>
    <MudTextField T="string" @bind-Value="ViewModel.JsonPath"
                  Label="JSONPath（示例：$.user.name 或 $.items[0].id）"
                  Variant="Variant.Outlined"
                  Immediate="true" />
    <MudStack Row="true" Spacing="2" AlignItems="AlignItems.Center" Class="mt-3">
        <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="() => ViewModel.QueryJsonPath()">查询</MudButton>
        <MudButton Variant="Variant.Outlined" OnClick="() => ViewModel.ClearJsonPath()">清空结果</MudButton>
    </MudStack>
    <MudTextField T="string" Value="@ViewModel.JsonPathResult"
                  Label="结果"
                  Variant="Variant.Outlined"
                  TextFieldType="TextFieldType.MultiLine"
                  Lines="6"
                  ReadOnly="true"
                  Class="mt-3" />
</MudPaper>

@if (!string.IsNullOrWhiteSpace(ViewModel.InfoMessage))
{
    <MudAlert Severity="Severity.Info" Dense="true" Class="mb-3">@ViewModel.InfoMessage</MudAlert>
}

@if (!string.IsNullOrWhiteSpace(ViewModel.ErrorMessage))
{
    <MudAlert Severity="Severity.Error" Dense="true">@ViewModel.ErrorMessage</MudAlert>
}

@if (!string.IsNullOrWhiteSpace(ViewModel.JsonPathError))
{
    <MudAlert Severity="Severity.Error" Dense="true" Class="mt-2">@ViewModel.JsonPathError</MudAlert>
}
